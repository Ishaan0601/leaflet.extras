{"version":3,"file":"lfx-draw-bindings.js","mappings":"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","sources":["webpack://leaflet.extras/./inst/htmlwidgets/bindings/lfx-draw-bindings.js"],"sourcesContent":["/* global LeafletWidget, $, L, Shiny, HTMLWidgets */\r\n\r\nLeafletWidget.methods.addDrawToolbar = function(targetLayerId, targetGroup, options) {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.drawToolbar) {\r\n      map.drawToolbar.remove(map);\r\n      delete map.drawToolbar;\r\n    }\r\n\r\n    // FeatureGroup that will hold our drawn shapes/markers\r\n    // This can be an existing GeoJSON layer whose features can be edited/deleted or new ones added.\r\n    // OR an existing FeatureGroup whose features can be edited/deleted or new ones added.\r\n    // OR a new FeatureGroup to hold drawn shapes.\r\n    var editableFeatureGroup;\r\n\r\n    if(targetLayerId) {\r\n      // If we're given an existing GeoJSON layer find it and use it\r\n      editableFeatureGroup = map.layerManager.getLayer('geojson', targetLayerId);\r\n      if(editableFeatureGroup) {\r\n        map._editableGeoJSONLayerId = targetLayerId;\r\n      } else {\r\n        // throw an error if we can't find the target GeoJSON layer\r\n        throw 'GeoJSON layer with ID '+targetLayerId+' not Found';\r\n      }\r\n    } else {\r\n      // If we're given an existing FeatureLayer use that.\r\n      // In this case we don't throw an error if the specified FeatureGroup is not found,\r\n      // we silently create a new one.\r\n      if(!targetGroup) {\r\n        targetGroup = 'editableFeatureGroup';\r\n      }\r\n      editableFeatureGroup = map.layerManager.getLayerGroup(targetGroup, true);\r\n      map._editableFeatureGroupName = targetGroup;\r\n    }\r\n\r\n    // Create appropriate Marker Icon.\r\n    if(options && options.draw && options.draw.marker) {\r\n      if(options.draw.marker.markerIcon &&\r\n        options.draw.marker.markerIconFunction) {\r\n        options.draw.marker.icon =\r\n          options.draw.marker.markerIconFunction(\r\n            options.draw.marker.markerIcon);\r\n      }\r\n    }\r\n\r\n    // create appropriate options\r\n    if(!$.isEmptyObject(options.edit)) {\r\n      var editOptions = {};\r\n      if(!options.edit.remove) {\r\n        editOptions.remove = false;\r\n      }\r\n      if(!options.edit.edit) {\r\n        editOptions.edit = false;\r\n      } else if(!$.isEmptyObject(options.edit.selectedPathOptions)) {\r\n        editOptions.edit = {};\r\n        editOptions.edit.selectedPathOptions =\r\n          options.edit.selectedPathOptions;\r\n      }\r\n\r\n      if(!$.isEmptyObject(options.edit.poly)) {\r\n        editOptions.poly = options.edit.poly;\r\n      }\r\n\r\n      editOptions.featureGroup = editableFeatureGroup;\r\n      options.edit = editOptions;\r\n    }\r\n\r\n    // Set Toolbar / Handlers options if provided. Changes the default values.\r\n    if (options && options.toolbar) {\r\n      var rtool = options.toolbar;\r\n      var tooldef = L.drawLocal.draw.toolbar;\r\n      L.drawLocal.draw.toolbar.buttons = Object.assign({}, tooldef.buttons, rtool.buttons);\r\n      L.drawLocal.draw.toolbar.actions = Object.assign({}, tooldef.actions, rtool.actions);\r\n      L.drawLocal.draw.toolbar.finish = Object.assign({}, tooldef.finish, rtool.finish);\r\n      L.drawLocal.draw.toolbar.undo = Object.assign({}, tooldef.undo, rtool.undo);\r\n    }\r\n    if (options && options.handlers) {\r\n      var rhand = options.handlers;\r\n      var handldef = L.drawLocal.draw.handlers;\r\n      L.drawLocal.draw.handlers.circle = Object.assign({}, handldef.circle, rhand.circle);\r\n      L.drawLocal.draw.handlers.circlemarker = Object.assign({}, handldef.circlemarker, rhand.circlemarker);\r\n      L.drawLocal.draw.handlers.marker = Object.assign({}, handldef.marker, rhand.marker);\r\n      L.drawLocal.draw.handlers.polygon = Object.assign({}, handldef.polygon, rhand.polygon);\r\n      L.drawLocal.draw.handlers.polyline = Object.assign({}, handldef.polyline, rhand.polyline);\r\n      L.drawLocal.draw.handlers.rectangle = Object.assign({}, handldef.rectangle, rhand.rectangle);\r\n    }\r\n\r\n    // Create new Drawing Control\r\n    map.drawToolbar =  new L.Control.Draw(options);\r\n    map.drawToolbar.addTo(map);\r\n\r\n    // Event Listeners\r\n    map.on(L.Draw.Event.DRAWSTART, function(e) {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_start', {'feature_type': e.layerType, 'nonce': Math.random()});\r\n    });\r\n\r\n    map.on(L.Draw.Event.DRAWSTOP, function(e) {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_stop', {'feature_type': e.layerType,'nonce': Math.random()});\r\n    });\r\n\r\n    map.on(L.Draw.Event.CREATED, function (e) {\r\n      if (options.draw.singleFeature){\r\n        if (editableFeatureGroup.getLayers().length > 0) {\r\n          editableFeatureGroup.clearLayers();\r\n        }\r\n      }\r\n\r\n      var layer = e.layer;\r\n      editableFeatureGroup.addLayer(layer);\r\n\r\n      // assign a unique key to the newly created feature\r\n      var featureId = L.stamp(layer);\r\n      layer.feature = {\r\n        'type' : 'Feature',\r\n        'properties' : {\r\n          '_leaflet_id' : featureId,\r\n          'feature_type' : e.layerType\r\n        }\r\n      };\r\n\r\n      // circles are just Points and toGeoJSON won't store radius by default\r\n      // so we store it inside the properties.\r\n      if(typeof layer.getRadius === 'function') {\r\n        layer.feature.properties.radius = layer.getRadius();\r\n      }\r\n\r\n      if (!HTMLWidgets.shinyMode) return;\r\n\r\n      Shiny.onInputChange(map.id+'_draw_new_feature',\r\n        layer.toGeoJSON());\r\n      Shiny.onInputChange(map.id+'_draw_all_features',\r\n        editableFeatureGroup.toGeoJSON());\r\n    });\r\n\r\n    map.on(L.Draw.Event.EDITSTART, function () {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_editstart', true);\r\n    });\r\n    map.on(L.Draw.Event.EDITSTOP, function () {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_editstop', true);\r\n    });\r\n\r\n    map.on(L.Draw.Event.EDITED, function (e) {\r\n      var layers = e.layers;\r\n      layers.eachLayer(function(layer){\r\n        var featureId = L.stamp(layer);\r\n        if(!layer.feature) {\r\n          layer.feature = {'type' : 'Feature'};\r\n        }\r\n        if(!layer.feature.properties) {\r\n          layer.feature.properties = {};\r\n        }\r\n        layer.feature.properties._leaflet_id = featureId;\r\n        layer.feature.properties.layerId = layer.options.layerId;\r\n        if(typeof layer.getRadius === 'function') {\r\n          layer.feature.properties.radius = layer.getRadius();\r\n        }\r\n      });\r\n\r\n      if (!HTMLWidgets.shinyMode) return;\r\n\r\n      Shiny.onInputChange(map.id+'_draw_edited_features',\r\n        layers.toGeoJSON());\r\n      Shiny.onInputChange(map.id+'_draw_all_features',\r\n        editableFeatureGroup.toGeoJSON());\r\n    });\r\n\r\n    map.on(L.Draw.Event.DELETESTART, function () {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_deletestart', true);\r\n    });\r\n\r\n    map.on(L.Draw.Event.DELETESTOP, function () {\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_deletestop', true);\r\n    });\r\n\r\n    map.on(L.Draw.Event.DELETED, function (e) {\r\n      var layers = e.layers;\r\n      layers.eachLayer(function(layer){\r\n        var featureId = L.stamp(layer);\r\n        if(!layer.feature) {\r\n          layer.feature = {'type' : 'Feature'};\r\n        }\r\n        if(!layer.feature.properties) {\r\n          layer.feature.properties = {};\r\n        }\r\n        layer.feature.properties._leaflet_id = featureId;\r\n        layer.feature.properties.layerId = layer.options.layerId;\r\n        if(typeof layer.getRadius === 'function') {\r\n          layer.feature.properties.radius = layer.getRadius();\r\n        }\r\n      });\r\n\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_draw_deleted_features',\r\n        layers.toGeoJSON());\r\n      Shiny.onInputChange(map.id+'_draw_all_features',\r\n        editableFeatureGroup.toGeoJSON());\r\n    });\r\n\r\n  }).call(this);\r\n\r\n};\r\n\r\nLeafletWidget.methods.removeDrawToolbar = function(clearFeatures) {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.drawToolbar) {\r\n      map.drawToolbar.remove(map);\r\n      delete map.drawToolbar;\r\n    }\r\n    if(map._editableFeatureGroupName && clearFeatures) {\r\n      var featureGroup = map.layerManager.getLayerGroup(map._editableFeatureGroupName, false);\r\n      featureGroup.clearLayers();\r\n    }\r\n    map._editableFeatureGroupName = null;\r\n    if(map._editableGeoJSONLayerId && clearFeatures) {\r\n      map.layerManager.removeLayer('geojson', map._editableGeoJSONLayerId);\r\n    }\r\n    map._editableGeoJSONLayerId = null;\r\n  }).call(this);\r\n\r\n};\r\n\r\n\r\n// TODO - not used for now. Missing R-function..Is it working?\r\nLeafletWidget.methods.getDrawnItems = function() {\r\n  var map = this;\r\n\r\n  var featureGroup;\r\n  if(map._editableGeoJSONLayerId) {\r\n    featureGroup = map.layerManager.getLayer('geojson', map._editableGeoJSONLayerId);\r\n  } else if(map._editableFeatureGroupName) {\r\n    featureGroup = map.layerManager.getLayerGroup(map._editableFeatureGroupName, false);\r\n  }\r\n  if(featureGroup) {\r\n    return featureGroup.toGeoJSON();\r\n  } else {\r\n    return null;\r\n  }\r\n\r\n};\r\n"],"names":["LeafletWidget","methods","addDrawToolbar","targetLayerId","targetGroup","options","editableFeatureGroup","map","this","drawToolbar","remove","layerManager","getLayer","_editableGeoJSONLayerId","getLayerGroup","_editableFeatureGroupName","draw","marker","markerIcon","markerIconFunction","icon","$","isEmptyObject","edit","editOptions","selectedPathOptions","poly","featureGroup","toolbar","rtool","tooldef","L","drawLocal","buttons","Object","assign","actions","finish","undo","handlers","rhand","handldef","circle","circlemarker","polygon","polyline","rectangle","Control","Draw","addTo","on","Event","DRAWSTART","e","HTMLWidgets","shinyMode","Shiny","onInputChange","id","layerType","Math","random","DRAWSTOP","CREATED","singleFeature","getLayers","length","clearLayers","layer","addLayer","featureId","stamp","feature","getRadius","properties","radius","toGeoJSON","EDITSTART","EDITSTOP","EDITED","layers","eachLayer","_leaflet_id","layerId","DELETESTART","DELETESTOP","DELETED","call","removeDrawToolbar","clearFeatures","removeLayer","getDrawnItems"],"sourceRoot":""}