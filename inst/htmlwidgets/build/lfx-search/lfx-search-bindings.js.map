{"version":3,"file":"lfx-search-bindings.js","mappings":"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","sources":["webpack://leaflet.extras/./inst/htmlwidgets/bindings/lfx-search-bindings.js"],"sourcesContent":["/* global $, LeafletWidget, L, Shiny, HTMLWidgets, google */\r\n\r\n// helper function to conver JS event to Shiny Event\r\nfunction eventToShiny(e) {\r\n  var shinyEvent = {};\r\n  shinyEvent.latlng = {};\r\n  shinyEvent.latlng.lat = e.latlng.lat;\r\n  shinyEvent.latlng.lng = e.latlng.lng;\r\n  if(!$.isEmptyObject(e.title)) {\r\n    shinyEvent.title = e.title;\r\n  }\r\n  if(!$.isEmptyObject(e.layer)) {\r\n    shinyEvent.layer = e.layer.toGeoJSON();\r\n  }\r\n  return shinyEvent;\r\n}\r\n\r\nLeafletWidget.methods.addSearchOSM = function(options) {\r\n\r\n  (function(){\r\n    var map = this;\r\n\r\n    if(map.searchControlOSM) {\r\n      map.searchControlOSM.removeFrom(map);\r\n      delete map.searchControlOSM;\r\n    }\r\n\r\n    options = options || {};\r\n    options.textPlaceholder = options.textPlaceholder ? options.textPlaceholder : 'Search using OSM Geocoder';\r\n    options.url = options.url ? options.url : 'https://nominatim.openstreetmap.org/search?format=json&q={s}';\r\n    options.jsonpParam = options.jsonpParam ? options.jsonpParam : 'json_callback';\r\n    options.propertyName = options.propertyName ? options.propertyName : 'display_name';\r\n    options.propertyLoc = options.propertyLoc ? options.propertyLoc : ['lat','lon'];\r\n\r\n    // https://github.com/stefanocudini/leaflet-search/issues/129\r\n    options.marker = L.circleMarker([0,0],{radius:30});\r\n\r\n    if(options.moveToLocation) {\r\n      options.moveToLocation = function(latlng, title, map) {\r\n        var zoom = options.zoom || 16;\r\n        var maxZoom = map.getMaxZoom();\r\n        if(maxZoom && zoom > maxZoom) {\r\n          zoom = maxZoom;\r\n        }\r\n        map.setView(latlng, zoom);\r\n      };\r\n    }\r\n\r\n    map.searchControlOSM = new L.Control.Search(options);\r\n    map.searchControlOSM.addTo(map);\r\n\r\n    map.searchControlOSM.on('search:locationfound', function(e){\r\n      // Shiny stuff\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_search_location_found', eventToShiny(e));\r\n    });\r\n\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.removeSearchOSM = function() {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.searchControlOSM) {\r\n      map.searchControlOSM.removeFrom(map);\r\n      delete map.searchControlOSM;\r\n    }\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.addReverseSearchOSM = function(options, group) {\r\n  (function() {\r\n\r\n    var map = this;\r\n\r\n    group = group || 'reverse_search_osm' ;\r\n    map.layerManager.clearGroup(group);\r\n\r\n    var displayControl = document.getElementById('reverseSearchOSM');\r\n\r\n    var searchURL = 'https://nominatim.openstreetmap.org/reverse?format=json&polygon_geojson=1';\r\n\r\n    map.on('click', function(e){\r\n\r\n      var latlng = e.latlng;\r\n\r\n      // This will hold the query, boundingbox, and found feature layers\r\n      var container = L.featureGroup();\r\n      var layerID = L.stamp(container);\r\n\r\n      if(options.showSearchLocation) {\r\n        var marker = L.marker(e.latlng,{'type': 'query'}).bindTooltip(\r\n          'lat='+latlng.lat+' lng='+latlng.lng+'</P>');\r\n        /* eslint-disable no-unused-vars */\r\n        var m_layerID = L.stamp(marker);\r\n        /* eslint-enable no-unused-vars */\r\n        container.addLayer(marker);\r\n      }\r\n\r\n      var query = searchURL + '&lat=' + latlng.lat + '&lon=' + latlng.lng;\r\n\r\n      $.ajax({url: query, dataType: 'json'}).done(function(result){\r\n\r\n        if(!$.isEmptyObject(displayControl)) {\r\n          var displayText = '<div>';\r\n          displayText = displayText + 'Display Name: ' +\r\n            ( (result.display_name) ?  result.display_name : '' ) + '<br/>';\r\n          displayText =  displayText + '</div>';\r\n          displayControl.innerHTML = displayText;\r\n        }\r\n\r\n        var bb = L.latLngBounds(\r\n          L.latLng(result.boundingbox[0],result.boundingbox[2]),\r\n          L.latLng(result.boundingbox[1], result.boundingbox[3]));\r\n\r\n        if(options.showBounds) {\r\n          var rect = L.rectangle(bb, {\r\n            weight:2, color: '#444444', clickable: false,\r\n            dashArray: '5,10', 'type': 'result_boundingbox'});\r\n          /* eslint-disable no-unused-vars */\r\n          var bb_layerID = L.stamp(rect);\r\n          /* eslint-enable no-unused-vars */\r\n          container.addLayer(rect);\r\n        }\r\n\r\n        if(options.showFeature) {\r\n          var feature = L.geoJson(result.geojson,\r\n            {\r\n              weight:2, color: 'red', dashArray: '5,10',\r\n              clickable : false, 'type': 'result_feature',\r\n              pointToLayer: function(feature, latlng) {\r\n                return L.circleMarker(latlng,{\r\n                  weight:2, color: 'red', dashArray: '5,10', clickable : false});\r\n              }\r\n            });\r\n\r\n          /* eslint-disable no-unused-vars */\r\n          var f_layerID = L.stamp(feature);\r\n          /* eslint-enable no-unused-vars */\r\n          container.addLayer(feature);\r\n        }\r\n\r\n        var tmp = container.getLayers();\r\n        if(!$.isEmptyObject(tmp) && tmp.length >= 0) {\r\n\r\n          if(!$.isEmptyObject(marker)) {\r\n            marker.on('mouseover', function(e){\r\n              if(!$.isEmptyObject(rect)) {\r\n                rect.setStyle({fillOpacity: 0.5, opacity: 0.8, weight: 5});\r\n                rect.bringToFront();\r\n              }\r\n              if(!$.isEmptyObject(feature)) {\r\n                feature.setStyle({fillOpacity: 0.5, opacity: 0.8, weight: 5});\r\n                feature.bringToFront();\r\n              }\r\n            });\r\n            marker.on('mouseout', function(e){\r\n              if(!$.isEmptyObject(rect)) {\r\n                rect.setStyle({fillOpacity: 0.2, opacity: 0.5, weight: 2});\r\n                rect.bringToBack();\r\n              }\r\n              if(!$.isEmptyObject(feature)) {\r\n                feature.setStyle({fillOpacity: 0.2, opacity: 0.5, weight: 2});\r\n                feature.bringToBack();\r\n              }\r\n            });\r\n          }\r\n\r\n          map.layerManager.addLayer(container, 'search', layerID, group);\r\n          if(options.fitBounds)\r\n            map.fitBounds(container.getBounds());\r\n        }\r\n\r\n        if (HTMLWidgets.shinyMode) {\r\n          Shiny.onInputChange(map.id+'_reverse_search_feature_found',{\r\n            'query': {'lat': latlng.lat, 'lng': latlng.lng},\r\n            'result': result\r\n          });\r\n        }\r\n\r\n      });\r\n    });\r\n\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.addSearchGoogle = function(options) {\r\n\r\n  (function(){\r\n    var map = this;\r\n\r\n    if(map.searchControlGoogle) {\r\n      map.searchControlGoogle.removeFrom(map);\r\n      delete map.searchControlGoogle;\r\n    }\r\n\r\n    var geocoder = new google.maps.Geocoder();\r\n\r\n    function googleGeocoding(text, callResponse) {\r\n      geocoder.geocode({address: text}, callResponse);\r\n    }\r\n\r\n    function formatJSON(rawjson) {\r\n      var json = {},\r\n        key, loc;\r\n\r\n      for(var i in rawjson) {\r\n        key = rawjson[i].formatted_address;\r\n        loc = L.latLng( rawjson[i].geometry.location.lat(), rawjson[i].geometry.location.lng() );\r\n        json[ key ]= loc; //key,value format\r\n      }\r\n      return json;\r\n    }\r\n\r\n    options = options || {};\r\n    options.markerLocation = true;\r\n    options.textPlaceholder = options.textPlaceholder ? options.textPlaceholder : 'Search using Google Geocoder';\r\n\r\n    // https://github.com/stefanocudini/leaflet-search/issues/129\r\n    options.marker = L.circleMarker([0,0],{radius:30});\r\n\r\n    if(options.moveToLocation) {\r\n      options.moveToLocation = function(latlng, title, map) {\r\n        var zoom = options.zoom || 16;\r\n        var maxZoom = map.getMaxZoom();\r\n        if(maxZoom && zoom > maxZoom) {\r\n          zoom = maxZoom;\r\n        }\r\n        map.setView(latlng, zoom);\r\n      };\r\n    }\r\n\r\n    options.sourceData = googleGeocoding;\r\n    options.formatData = formatJSON;\r\n\r\n    map.searchControlGoogle = new L.Control.Search(options);\r\n    map.searchControlGoogle.addTo(map);\r\n\r\n    map.searchControlGoogle.on('search:locationfound', function(e){\r\n      // Shiny stuff\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_search_location_found', eventToShiny(e));\r\n    });\r\n\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.removeSearchGoogle = function() {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.searchControlGoogle) {\r\n      map.searchControlGoogle.removeFrom(map);\r\n      delete map.searchControlGoogle;\r\n    }\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.addReverseSearchGoogle = function(options, group) {\r\n  (function() {\r\n\r\n    var map = this;\r\n\r\n    group = group || 'reverse_search_google' ;\r\n    map.layerManager.clearGroup(group);\r\n\r\n    var displayControl = document.getElementById('reverseSearchGoogle');\r\n\r\n    var geocoder = new google.maps.Geocoder();\r\n\r\n    map.on('click', function(e){\r\n\r\n      var latlng = e.latlng;\r\n\r\n      // This will hold the query, boundingbox, and found feature layers\r\n      var container = L.featureGroup();\r\n      var layerID = L.stamp(container);\r\n\r\n      if(options.showSearchLocation) {\r\n        var marker = L.marker(e.latlng,{'type': 'query'}).bindTooltip(\r\n          'lat='+latlng.lat+' lng='+latlng.lng+'</P>');\r\n        /* eslint-disable no-unused-vars */\r\n        var m_layerID = L.stamp(marker);\r\n        /* eslint-enable no-unused-vars */\r\n        container.addLayer(marker);\r\n      }\r\n\r\n      geocoder.geocode(\r\n        {'location': {'lat': latlng.lat, 'lng': latlng.lng}},\r\n        function(results, status) {\r\n\r\n          if(status === 'OK') {\r\n            if(results[0]) {\r\n              var result = results[0];\r\n\r\n              if(!$.isEmptyObject(displayControl)) {\r\n                var displayText = '<div>';\r\n                displayText = displayText + 'Address: ' +\r\n                  ( (result.formatted_address) ?  result.formatted_address : '' ) + '<br/>';\r\n                displayText =  displayText + '</div>';\r\n                displayControl.innerHTML = displayText;\r\n              }\r\n\r\n              var bb = L.latLngBounds(\r\n                L.latLng(result.geometry.viewport.f.f,\r\n                  result.geometry.viewport.b.b),\r\n                L.latLng(result.geometry.viewport.f.b,\r\n                  result.geometry.viewport.b.f));\r\n\r\n              if(options.showBounds) {\r\n                var rect = L.rectangle(bb, {\r\n                  weight:2, color: '#444444', clickable: false,\r\n                  dashArray: '5,10', 'type': 'result_boundingbox'});\r\n                /* eslint-disable no-unused-vars */\r\n                var bb_layerID = L.stamp(rect);\r\n                /* eslint-enable no-unused-vars */\r\n                container.addLayer(rect);\r\n              }\r\n\r\n              if(options.showFeature) {\r\n                var feature = L.circleMarker(\r\n                  L.latLng(\r\n                    result.geometry.location.lat(),\r\n                    result.geometry.location.lng()\r\n                  ), {\r\n                    weight:2, color: 'red', dashArray: '5,10',\r\n                    clickable : false, 'type': 'result_feature'\r\n                  }\r\n                );\r\n\r\n                /* eslint-disable no-unused-vars */\r\n                var f_layerID = L.stamp(feature);\r\n                /* eslint-disable no-unused-vars */\r\n                container.addLayer(feature);\r\n              }\r\n\r\n              var tmp = container.getLayers();\r\n              if(!$.isEmptyObject(tmp) && tmp.length >= 0) {\r\n\r\n                if(!$.isEmptyObject(marker)) {\r\n                  marker.on('mouseover', function(e){\r\n                    if(!$.isEmptyObject(rect)) {\r\n                      rect.setStyle({fillOpacity: 0.5, opacity: 0.8, weight: 5});\r\n                      rect.bringToFront();\r\n                    }\r\n                    if(!$.isEmptyObject(feature)) {\r\n                      feature.setStyle({fillOpacity: 0.5, opacity: 0.8, weight: 5});\r\n                      feature.bringToFront();\r\n                    }\r\n                  });\r\n                  marker.on('mouseout', function(e){\r\n                    if(!$.isEmptyObject(rect)) {\r\n                      rect.setStyle({fillOpacity: 0.2, opacity: 0.5, weight: 2});\r\n                      rect.bringToBack();\r\n                    }\r\n                    if(!$.isEmptyObject(feature)) {\r\n                      feature.setStyle({fillOpacity: 0.2, opacity: 0.5, weight: 2});\r\n                      feature.bringToBack();\r\n                    }\r\n                  });\r\n                }\r\n\r\n                map.layerManager.addLayer(container, 'search', layerID, group);\r\n                if(options.fitBounds)\r\n                  map.fitBounds(container.getBounds());\r\n              }\r\n\r\n              if (HTMLWidgets.shinyMode) {\r\n                Shiny.onInputChange(map.id+'_reverse_search_feature_found',{\r\n                  'query': {'lat': latlng.lat, 'lng': latlng.lng},\r\n                  'result': result\r\n                });\r\n              }\r\n            } else {\r\n              if(!$.isEmptyObject(displayControl))\r\n                displayControl.innerHTML = 'No Results Found';\r\n              /* eslint-disable no-console */\r\n              console.error('No Results Found');\r\n              /* eslint-enable no-console */\r\n            }\r\n          } else {\r\n            if(!$.isEmptyObject(displayControl))\r\n              displayControl.innerHTML = 'Reverse Geocoding failed due to: ' + status;\r\n            /* eslint-disable no-console */\r\n            console.error('Reverse Geocoing failed due to: ' + status);\r\n            /* eslint-enable no-console */\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }).call(this);\r\n};\r\n\r\n\r\nLeafletWidget.methods.addSearchUSCensusBureau = function(options) {\r\n  (function(){\r\n    var map = this;\r\n\r\n    if(map.searchControlUSCensusBureau) {\r\n      map.searchControlUSCensusBureau.removeFrom(map);\r\n      delete map.searchControlUSCensusBureau;\r\n    }\r\n\r\n    function formatJSON(rawjson) {\r\n      var json = {}, key, loc;\r\n\r\n      for (var i in rawjson.result.addressMatches) {\r\n        key = rawjson.result.addressMatches[i].matchedAddress;\r\n        loc = L.latLng(rawjson.result.addressMatches[i].coordinates.y, rawjson.result.addressMatches[i].coordinates.x);\r\n        json[key] = loc; //key,value format\r\n      }\r\n      return json;\r\n    }\r\n\r\n    options = options || {};\r\n\r\n    options.url = options.url ? options.url : 'https://geocoding.geo.census.gov/geocoder/locations/onelineaddress?benchmark=Public_AR_Current&format=jsonp&address={s}';\r\n    options.textPlaceholder = options.textPlaceholder ? options.textPlaceholder : 'Search using US Census Bureau TEST';\r\n\r\n    options.jsonpParam = options.jsonpParam ? options.jsonpParam : 'callback';\r\n    options.formatData = formatJSON;\r\n\r\n    // https://github.com/stefanocudini/leaflet-search/issues/129\r\n    options.marker = L.circleMarker([0,0],{radius:30});\r\n\r\n    if(options.moveToLocation) {\r\n      options.moveToLocation = function(latlng, title, map) {\r\n        var zoom = options.zoom || 16;\r\n        var maxZoom = map.getMaxZoom();\r\n        if(maxZoom && zoom > maxZoom) {\r\n          zoom = maxZoom;\r\n        }\r\n        map.setView(latlng, zoom);\r\n      };\r\n    }\r\n\r\n    map.searchControlUSCensusBureau = new L.Control.Search(options);\r\n    map.searchControlUSCensusBureau.addTo(map);\r\n\r\n    map.searchControlUSCensusBureau.on('search:locationfound', function(e){\r\n      // Shiny stuff\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_search_location_found', eventToShiny(e));\r\n    });\r\n\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.removeSearchUSCensusBureau = function() {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.searchControlUSCensusBureau) {\r\n      map.searchControlUSCensusBureau.removeFrom(map);\r\n      delete map.searchControlUSCensusBureau;\r\n    }\r\n  }).call(this);\r\n};\r\n\r\n\r\nLeafletWidget.methods.addSearchFeatures = function(targetGroups, options){\r\n\r\n  (function(){\r\n    var map = this;\r\n\r\n    if(map.searchControl) {\r\n      map.searchControl.removeFrom(map);\r\n      delete map.searchControl;\r\n    }\r\n\r\n    options = options || {};\r\n\r\n    if(options.moveToLocation) {\r\n      options.moveToLocation = function(latlng, title, map) {\r\n        var zoom = options.zoom || 16;\r\n        var maxZoom = map.getMaxZoom();\r\n        if(maxZoom && zoom > maxZoom) {\r\n          zoom = maxZoom;\r\n        }\r\n        map.setView(latlng, zoom);\r\n      };\r\n    }\r\n\r\n    // FeatureGroup that will be searched\r\n    var searchFeatureGroup;\r\n\r\n    // if we have just one group to search use it.\r\n    if(!L.Util.isArray(targetGroups)) {\r\n      var target = map.layerManager.getLayerGroup(targetGroups, false);\r\n      if(target) {\r\n        searchFeatureGroup = target;\r\n        map._searchFeatureGroupName = targetGroups;\r\n      } else {\r\n        // throw an error if we can't find the target FeatureGroup layer\r\n        throw 'Group with ID \"'+targetGroups+'\" not found';\r\n      }\r\n    } else { // if we have more than one groups to search create a new seach group with them.\r\n\r\n      searchFeatureGroup = map.layerManager.getLayerGroup('search', true);\r\n      map._searchFeatureGroupName = 'search';\r\n\r\n      $.each(targetGroups, function(k, v) {\r\n        var target = map.layerManager.getLayerGroup(v, false);\r\n        // may be remove target from map before adding to searchFeatureGroup\r\n        if(target) {\r\n          searchFeatureGroup.addLayer(target);\r\n        } else {\r\n          /* eslint-disable no-console */\r\n          console.warn('Group with ID \"' + v + '\" not Found, skipping');\r\n          /* eslint-enable no-console */\r\n        }\r\n      });\r\n    }\r\n\r\n    L.stamp(searchFeatureGroup);\r\n    options.layer = searchFeatureGroup;\r\n    map.searchControl = new L.Control.Search(options);\r\n    map.searchControl.addTo(map);\r\n\r\n    map.searchControl.on('search:locationfound', function(e){\r\n      if(options.openPopup && e.layer._popup) {\r\n        e.layer.openPopup();\r\n      }\r\n      // Shiny stuff\r\n      if (!HTMLWidgets.shinyMode) return;\r\n      Shiny.onInputChange(map.id+'_search_location_found', eventToShiny(e));\r\n    });\r\n\r\n  }).call(this);\r\n};\r\n\r\nLeafletWidget.methods.removeSearchFeatures = function(clearFeatures) {\r\n  (function(){\r\n\r\n    var map = this;\r\n\r\n    if(map.searchControl) {\r\n      map.searchControl.removeFrom(map);\r\n      delete map.searchControl;\r\n    }\r\n    if(clearFeatures && map._searchFeatureGroupName) {\r\n      map.layerManager.clearGroup(map._searchFeatureGroupName);\r\n      delete map._searchFeatureGroupName ;\r\n    }\r\n  }).call(this);\r\n\r\n};\r\n"],"names":["eventToShiny","e","shinyEvent","latlng","lat","lng","$","isEmptyObject","title","layer","toGeoJSON","LeafletWidget","methods","addSearchOSM","options","map","this","searchControlOSM","removeFrom","textPlaceholder","url","jsonpParam","propertyName","propertyLoc","marker","L","circleMarker","radius","moveToLocation","zoom","maxZoom","getMaxZoom","setView","Control","Search","addTo","on","HTMLWidgets","shinyMode","Shiny","onInputChange","id","call","removeSearchOSM","addReverseSearchOSM","group","layerManager","clearGroup","displayControl","document","getElementById","container","featureGroup","layerID","stamp","showSearchLocation","bindTooltip","addLayer","query","searchURL","ajax","dataType","done","result","displayText","display_name","innerHTML","bb","latLngBounds","latLng","boundingbox","showBounds","rect","rectangle","weight","color","clickable","dashArray","showFeature","feature","geoJson","geojson","pointToLayer","tmp","getLayers","length","setStyle","fillOpacity","opacity","bringToFront","bringToBack","fitBounds","getBounds","addSearchGoogle","searchControlGoogle","geocoder","google","maps","Geocoder","markerLocation","sourceData","text","callResponse","geocode","address","formatData","rawjson","key","loc","json","i","formatted_address","geometry","location","removeSearchGoogle","addReverseSearchGoogle","results","status","viewport","f","b","console","error","addSearchUSCensusBureau","searchControlUSCensusBureau","addressMatches","matchedAddress","coordinates","y","x","removeSearchUSCensusBureau","addSearchFeatures","targetGroups","searchFeatureGroup","searchControl","Util","isArray","getLayerGroup","_searchFeatureGroupName","each","k","v","target","warn","openPopup","_popup","removeSearchFeatures","clearFeatures"],"sourceRoot":""}