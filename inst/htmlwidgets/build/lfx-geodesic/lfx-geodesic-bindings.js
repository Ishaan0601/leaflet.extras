(()=>{"use strict";function e(e){return e instanceof Array?e:[e]}function t(t){return t?void 0===t.index?t:(t.data=e(t.data),t.index=e(t.index),$.map(t.index,(function(e,n){return t.data[e]}))):t}function n(e,t,n,o,a,r,i){n.showStats&&i(r);var l=o.get(a,"group");if(HTMLWidgets.shinyMode){let n=e.target.getLatLng?e.target.getLatLng():e.latlng;if(n){const e=L.latLng(n);n={lat:e.lat,lng:e.lng}}const i=$.extend({id:o.get(a,"layerId"),".nonce":Math.random()},null!==l?{group:l}:null,n,r);Shiny.onInputChange(map.id+t,i)}}LeafletWidget.methods.addGeodesicPolylines=function(e,n,o,a,r,i,l,s,c,d,h,u){if(e.length>0){const d=this;var g=L.control();g.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this._div};const u=function(e,t){if(a.showStats){var n="";n="function"==typeof a.statsFunction?a.statsFunction(e):"<h4>Statistics</h4><b>totalDistance</b><br/>"+(e.totalDistance?e.totalDistance>1e4?(e.totalDistance/1e3).toFixed(0)+" km":e.totalDistance.toFixed(0)+" m":"invalid")+"<br/><br/><b>Points</b><br/>"+e.points+"<br/><br/><b>Vertices</b><br/>"+e.vertices,g._div.innerHTML=n}};g.update=u,a.showStats&&g.addTo(d);const w=(new LeafletWidget.DataFrame).col("polygons",e).col("popup",i).col("layerId",n).col("label",s).col("group",o).cbind(a),f=[];let b,y;r&&(r.awesomemarker||(r.iconUrl=t(r.iconUrl),r.iconRetinaUrl=t(r.iconRetinaUrl),r.shadowUrl=t(r.shadowUrl),r.shadowRetinaUrl=t(r.shadowRetinaUrl)),b=(new LeafletWidget.DataFrame).cbind(r),y=function(e){const t=b.get(e);return t?t.awesomemarker?(delete t.awesomemarker,t.squareMarker&&(t.className="awesome-marker awesome-marker-square"),t.prefix||(t.prefix=r.library),new L.AwesomeMarkers.icon(t)):(t.iconWidth&&(t.iconSize=[t.iconWidth,t.iconHeight]),t.shadowWidth&&(t.shadowSize=[t.shadowWidth,t.shadowHeight]),t.iconAnchorX&&(t.iconAnchor=[t.iconAnchorX,t.iconAnchorY]),t.shadowAnchorX&&(t.shadowAnchor=[t.shadowAnchorX,t.shadowAnchorY]),t.popupAnchorX&&(t.popupAnchor=[t.popupAnchorX,t.popupAnchorY]),new L.Icon(t)):t.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),r&&(b.effectiveLength=e.length);for(let e=0;e<w.nrow();e++){const t=w.get(e,"polygons")[0].flatMap((e=>e.lat.map(((t,n)=>({lat:t,lng:e.lng[n]}))))),n=L.geodesic(t,w.get(e));if(u.call(g,n.statistics),d.layerManager.addLayer(n,"shape",w.get(e,"layerId"),w.get(e,"group"),null,null),a.showCenter){var p=[];for(const u of t){h=h||{},a.showCenter&&r&&(h.icon=y(e));var m=L.marker(u,h);null!==s&&(null!==c?m.bindTooltip(w.get(e,"label"),c):m.bindTooltip(w.get(e,"label"))),null!==i&&(null!==l?m.bindPopup(w.get(e,"popup"),l):m.bindPopup(w.get(e,"popup"))),d.layerManager.addLayer(m,"markers",null,o,null,null),d.on("layeradd",(function(e){e.layer===n&&d.layerManager.addLayer(m,"marker","______fake_layerid",o,null,null)})),d.on("layerremove",(function(e){e.layer===n&&d.layerManager.removeLayer("marker","______fake_layerid")})),m.on("drag",(t=>{d.fire("geodesicdrag",{index:e})})),p.push(m)}}f.push({Geodesic:n,markers:p})}const k=function(e){const{index:t}=e,n=[];for(const e of f[t].markers)n.push(e.getLatLng());f[t].Geodesic.setLatLngs(n),u.call(g,f[t].Geodesic.statistics)};d.on("geodesicdrag",k)}},LeafletWidget.methods.addLatLng=function(e,t,n){const o=this,a=o.layerManager.getLayer("shape",n);if(a){a.addLatLng({lat:e,lng:t});var r=L.marker({lat:e,lng:t});o.layerManager.addLayer(r,"markers",null,null,null,null)}else console.error("Geodesic object is not initialized.")},LeafletWidget.methods.addGreatCircles=function(e,o,a,r,i,l,s,c,d,h,u,g,p){if(!$.isEmptyObject(e)&&!$.isEmptyObject(o)||$.isNumeric(e)&&$.isNumeric(o)){const w=this;let f,b;s&&(s.awesomemarker||(s.iconUrl=t(s.iconUrl),s.iconRetinaUrl=t(s.iconRetinaUrl),s.shadowUrl=t(s.shadowUrl),s.shadowRetinaUrl=t(s.shadowRetinaUrl)),f=(new LeafletWidget.DataFrame).cbind(s),b=function(e){const t=f.get(e);return t?t.awesomemarker?(delete t.awesomemarker,t.squareMarker&&(t.className="awesome-marker awesome-marker-square"),t.prefix||(t.prefix=s.library),new L.AwesomeMarkers.icon(t)):(t.iconWidth&&(t.iconSize=[t.iconWidth,t.iconHeight]),t.shadowWidth&&(t.shadowSize=[t.shadowWidth,t.shadowHeight]),t.iconAnchorX&&(t.iconAnchor=[t.iconAnchorX,t.iconAnchorY]),t.shadowAnchorX&&(t.shadowAnchor=[t.shadowAnchorX,t.shadowAnchorY]),t.popupAnchorX&&(t.popupAnchor=[t.popupAnchorX,t.popupAnchorY]),new L.Icon(t)):t.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),s&&(f.effectiveLength=e.length);const y=(new LeafletWidget.DataFrame).col("lat",e).col("lng",o).col("radius",a).col("layerId",r).col("group",i).col("popup",c).col("popupOptions",d).col("label",h).col("labelOptions",u).col("highlightOptions",g).col("markerOptions",p).cbind(l);let k;if(l.showStats){var m=L.control();m.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this._div},m.addTo(w),k=function(e,t){var n="";n="function"==typeof l.statsFunction?l.statsFunction(e):"<h4>Statistics</h4><b>Total Distance</b><br/>"+(e.totalDistance?e.totalDistance>1e4?(e.totalDistance/1e3).toFixed(0)+" km":e.totalDistance.toFixed(0)+" m":"invalid")+"<br/><br/><b>Points</b><br/>"+e.points+"<br/><br/><b>Vertices</b><br/>"+e.vertices,m._div.innerHTML=n}}LeafletWidget.methods.addGenericLayers(this,"shape",y,(function(e,t){var o=e.get(t);const a=new L.LatLng(e.get(t,"lat"),e.get(t,"lng")),r=new L.GeodesicCircle(a,o);if(o.showCenter){p=p||{},o.showCenter&&s&&(p.icon=b(t));const i=L.marker(a,p);null!==h&&(null!==u?i.bindTooltip(e.get(t,"label"),u):i.bindTooltip(e.get(t,"label"))),null!==c&&(null!==d?i.bindPopup(e.get(t,"popup"),d):i.bindPopup(e.get(t,"popup"))),w.on("layeradd",(function(n){n.layer===r&&w.layerManager.addLayer(i,"marker",e.get(t,"layerId"),e.get(t,"group"),null,null)})),w.on("layerremove",(function(n){n.layer===r&&w.layerManager.removeLayer("marker",e.get(t,"layerId"))})),i.on("drag",(a=>{r.setLatLng(a.latlng),n(a,"_geodesic_stats",o,e,t,r.statistics,k)})),i.on("click",(a=>{n(a,"_geodesic_click",o,e,t,r.statistics,k)}))}return r.on("click",(a=>{n(a,"_geodesic_click",o,e,t,r.statistics,k)})),r.on("mouseover",(a=>{n(a,"_geodesic_mouseover",o,e,t,r.statistics,k)})),r}))}}})();