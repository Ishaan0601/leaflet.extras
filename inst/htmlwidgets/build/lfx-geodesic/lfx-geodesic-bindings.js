(()=>{"use strict";function e(e){return e instanceof Array?e:[e]}function n(n){return n?void 0===n.index?n:(n.data=e(n.data),n.index=e(n.index),$.map(n.index,(function(e,o){return n.data[e]}))):n}function o(e,n,o,a,t,r,i){o.showStats&&i(r);var l=a.get(t,"group");if(HTMLWidgets.shinyMode){let o=e.target.getLatLng?e.target.getLatLng():e.latlng;if(o){const e=L.latLng(o);o={lat:e.lat,lng:e.lng}}const i=$.extend({id:a.get(t,"layerId"),".nonce":Math.random()},null!==l?{group:l}:null,o,r);Shiny.onInputChange(map.id+n,i)}}LeafletWidget.methods.addGeodesicPolylines=function(e,o,a,t,r,i,l,s,c,d,g,h){if(e.length>0){const f=this;var u=L.control();function w(e,n){if(t.showStats){var o="";if("function"==typeof t.statsFunction)o=t.statsFunction(e);else{const n=e.totalDistance?e.totalDistance>1e4?(e.totalDistance/1e3).toFixed(0)+" km":e.totalDistance.toFixed(0)+" m":"invalid";innerHTML="<h4>Statistics</h4><b>totalDistance</b><br/>"+n+"<br/><br/><b>Points</b><br/>"+e.points+"<br/><br/><b>Vertices</b><br/>"+e.vertices}u._div.innerHTML=o}}u.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this._div},u.update=w,t.showStats&&u.addTo(f);let y=(new LeafletWidget.DataFrame).col("polygons",e).col("popup",i).col("layerId",o).col("label",s).col("group",a).cbind(t);const b=[];let k,A;r&&(r.awesomemarker||(r.iconUrl=n(r.iconUrl),r.iconRetinaUrl=n(r.iconRetinaUrl),r.shadowUrl=n(r.shadowUrl),r.shadowRetinaUrl=n(r.shadowRetinaUrl)),k=(new LeafletWidget.DataFrame).cbind(r),A=function(e){const n=k.get(e);return n?n.awesomemarker?(delete n.awesomemarker,n.squareMarker&&(n.className="awesome-marker awesome-marker-square"),n.prefix||(n.prefix=r.library),new L.AwesomeMarkers.icon(n)):(n.iconWidth&&(n.iconSize=[n.iconWidth,n.iconHeight]),n.shadowWidth&&(n.shadowSize=[n.shadowWidth,n.shadowHeight]),n.iconAnchorX&&(n.iconAnchor=[n.iconAnchorX,n.iconAnchorY]),n.shadowAnchorX&&(n.shadowAnchor=[n.shadowAnchorX,n.shadowAnchorY]),n.popupAnchorX&&(n.popupAnchor=[n.popupAnchorX,n.popupAnchorY]),new L.Icon(n)):n.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),r&&(k.effectiveLength=e.length);for(let v=0;v<y.nrow();v++){let M=y.get(v,"polygons")[0].flatMap((e=>e.lat.map(((n,o)=>({lat:n,lng:e.lng[o]})))));const U=L.geodesic(M,y.get(v));if(w.call(u,U.statistics),f.layerManager.addLayer(U,"shape",y.get(v,"layerId"),y.get(v,"group"),null,null),t.showCenter){var p=[];for(const W of M){g=g||{},t.showCenter&&r&&(g.icon=A(v));var m=L.marker(W,g);null!==s&&(null!==c?m.bindTooltip(y.get(v,"label"),c):m.bindTooltip(y.get(v,"label"))),null!==i&&(null!==l?m.bindPopup(y.get(v,"popup"),l):m.bindPopup(y.get(v,"popup"))),f.layerManager.addLayer(m,"markers",null,a,null,null),f.on("layeradd",(function(e){e.layer===U&&f.layerManager.addLayer(m,"marker","______fake_layerid",a,null,null)})),f.on("layerremove",(function(e){e.layer===U&&f.layerManager.removeLayer("marker","______fake_layerid")})),m.on("drag",(e=>{f.fire("geodesicdrag",{index:v,latlng:e.target.getLatLng()})})),p.push(m)}}b.push({Geodesic:U,markers:p})}function _(e){const{index:n,latlng:o}=e,a=[];for(const e of b[n].markers)a.push(e.getLatLng());b[n].Geodesic.setLatLngs(a),w.call(u,b[n].Geodesic.statistics)}f.on("geodesicdrag",_)}},LeafletWidget.methods.addLatLng=function(e,n,o){let a=this,t=a.layerManager.getLayer("shape",o);if(t){t.addLatLng({lat:e,lng:n});var r=L.marker({lat:e,lng:n});a.layerManager.addLayer(r,"markers",null,null,null,null)}else console.error("Geodesic object is not initialized.")},LeafletWidget.methods.addGreatCircles=function(e,a,t,r,i,l,s,c,d,g,h,u,p){if(!$.isEmptyObject(e)&&!$.isEmptyObject(a)||$.isNumeric(e)&&$.isNumeric(a)){const f=this;let w,y;s&&(s.awesomemarker||(s.iconUrl=n(s.iconUrl),s.iconRetinaUrl=n(s.iconRetinaUrl),s.shadowUrl=n(s.shadowUrl),s.shadowRetinaUrl=n(s.shadowRetinaUrl)),w=(new LeafletWidget.DataFrame).cbind(s),y=function(e){const n=w.get(e);return n?n.awesomemarker?(delete n.awesomemarker,n.squareMarker&&(n.className="awesome-marker awesome-marker-square"),n.prefix||(n.prefix=s.library),new L.AwesomeMarkers.icon(n)):(n.iconWidth&&(n.iconSize=[n.iconWidth,n.iconHeight]),n.shadowWidth&&(n.shadowSize=[n.shadowWidth,n.shadowHeight]),n.iconAnchorX&&(n.iconAnchor=[n.iconAnchorX,n.iconAnchorY]),n.shadowAnchorX&&(n.shadowAnchor=[n.shadowAnchorX,n.shadowAnchorY]),n.popupAnchorX&&(n.popupAnchor=[n.popupAnchorX,n.popupAnchorY]),new L.Icon(n)):n.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),s&&(w.effectiveLength=e.length);const b=(new LeafletWidget.DataFrame).col("lat",e).col("lng",a).col("radius",t).col("layerId",r).col("group",i).col("popup",c).col("popupOptions",d).col("label",g).col("labelOptions",h).col("highlightOptions",u).col("markerOptions",p).cbind(l);if(l.showStats){var m=L.control();m.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this._div},m.addTo(f)}LeafletWidget.methods.addGenericLayers(this,"shape",b,(function(e,n){var a=e.get(n);const t=new L.LatLng(e.get(n,"lat"),e.get(n,"lng")),r=new L.GeodesicCircle(t,a);if(a.showCenter){p=p||{},a.showCenter&&s&&(p.icon=y(n));const i=L.marker(t,p);null!==g&&(null!==h?i.bindTooltip(e.get(n,"label"),h):i.bindTooltip(e.get(n,"label"))),null!==c&&(null!==d?i.bindPopup(e.get(n,"popup"),d):i.bindPopup(e.get(n,"popup"))),f.on("layeradd",(function(o){o.layer===r&&f.layerManager.addLayer(i,"marker",e.get(n,"layerId"),e.get(n,"group"),null,null)})),f.on("layerremove",(function(o){o.layer===r&&f.layerManager.removeLayer("marker",e.get(n,"layerId"))})),i.on("drag",(t=>{r.setLatLng(t.latlng),o(t,"_geodesic_stats",a,e,n,r.statistics,updateInfo)})),i.on("click",(t=>{o(t,"_geodesic_click",a,e,n,r.statistics,updateInfo)}))}return r.on("click",(t=>{o(t,"_geodesic_click",a,e,n,r.statistics,updateInfo)})),r.on("mouseover",(t=>{o(t,"_geodesic_mouseover",a,e,n,r.statistics,updateInfo)})),r}))}}})();