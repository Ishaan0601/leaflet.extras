(()=>{"use strict";function e(e){return e instanceof Array?e:[e]}function o(o){return o?void 0===o.index?o:(o.data=e(o.data),o.index=e(o.index),$.map(o.index,(function(e){return o.data[e]}))):o}function n(e,o,n,t,a,r,i){n.showStats&&i(r);var l=t.get(a,"group");if(HTMLWidgets.shinyMode){let n=e.target.getLatLng?e.target.getLatLng():e.latlng;if(n){const e=L.latLng(n);n={lat:e.lat,lng:e.lng}}const i=$.extend({id:t.get(a,"layerId"),".nonce":Math.random()},null!==l?{group:l}:null,n,r);Shiny.onInputChange(map.id+o,i)}}LeafletWidget.methods.addGeodesicPolylines=function(e,n,t,a,r,i,l,s,c,d,h){if(e.length>0){const d=this;var g=L.control();g.onAdd=function(){return this._div=L.DomUtil.create("div","info"),this._div};const m=function(e,o){if(a.showStats){var n="";n="function"==typeof o?o(e):"<h4>Statistics</h4><b>totalDistance</b><br/>"+(e.totalDistance?e.totalDistance>1e4?(e.totalDistance/1e3).toFixed(0)+" km":e.totalDistance.toFixed(0)+" m":"invalid")+"<br/><br/><b>Points</b><br/>"+e.points+"<br/><br/><b>Vertices</b><br/>"+e.vertices,g._div.innerHTML=n}};g.update=m,a.showStats&&g.addTo(d);const w=(new LeafletWidget.DataFrame).col("polygons",e).col("popup",i).col("layerId",n).col("label",s).col("group",t).cbind(a),f=[];let b,y;r&&(r.awesomemarker||(r.iconUrl=o(r.iconUrl),r.iconRetinaUrl=o(r.iconRetinaUrl),r.shadowUrl=o(r.shadowUrl),r.shadowRetinaUrl=o(r.shadowRetinaUrl)),b=(new LeafletWidget.DataFrame).cbind(r),y=function(e){const o=b.get(e);return o?o.awesomemarker?(delete o.awesomemarker,o.squareMarker&&(o.className="awesome-marker awesome-marker-square"),o.prefix||(o.prefix=r.library),new L.AwesomeMarkers.icon(o)):(o.iconWidth&&(o.iconSize=[o.iconWidth,o.iconHeight]),o.shadowWidth&&(o.shadowSize=[o.shadowWidth,o.shadowHeight]),o.iconAnchorX&&(o.iconAnchor=[o.iconAnchorX,o.iconAnchorY]),o.shadowAnchorX&&(o.shadowAnchor=[o.shadowAnchorX,o.shadowAnchorY]),o.popupAnchorX&&(o.popupAnchor=[o.popupAnchorX,o.popupAnchorY]),new L.Icon(o)):o.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),r&&(b.effectiveLength=e.length);for(let e=0;e<w.nrow();e++){const o=w.get(e,"polygons")[0].flatMap((e=>e.lat.map(((o,n)=>({lat:o,lng:e.lng[n]}))))),n=L.geodesic(o,w.get(e));if(m.call(g,n.statistics),d.layerManager.addLayer(n,"shape",w.get(e,"layerId"),w.get(e,"group"),null,null),a.showCenter){var u=[];for(const g of o){h=h||{},a.showCenter&&r&&(h.icon=y(e));var p=L.marker(g,h);null!==s&&(null!==c?p.bindTooltip(w.get(e,"label"),c):p.bindTooltip(w.get(e,"label"))),null!==i&&(null!==l?p.bindPopup(w.get(e,"popup"),l):p.bindPopup(w.get(e,"popup"))),d.layerManager.addLayer(p,"markers",null,t,null,null),d.on("layeradd",(function(e){e.layer===n&&d.layerManager.addLayer(p,"marker","______fake_layerid",t,null,null)})),d.on("layerremove",(function(e){e.layer===n&&d.layerManager.removeLayer("marker","______fake_layerid")})),p.on("drag",(()=>{d.fire("geodesicdrag",{index:e})})),u.push(p)}}f.push({Geodesic:n,markers:u})}const k=function(e){const{index:o}=e,n=[];for(const e of f[o].markers)n.push(e.getLatLng());f[o].Geodesic.setLatLngs(n),m.call(g,f[o].Geodesic.statistics)};d.on("geodesicdrag",k)}},LeafletWidget.methods.addLatLng=function(e,o,n){const t=this,a=t.layerManager.getLayer("shape",n);if(a){a.addLatLng({lat:e,lng:o});var r=L.marker({lat:e,lng:o});t.layerManager.addLayer(r,"markers",null,null,null,null)}else console.error("Geodesic object is not initialized.")},LeafletWidget.methods.addGreatCircles=function(e,t,a,r,i,l,s,c,d,h,g,u,p){if(!$.isEmptyObject(e)&&!$.isEmptyObject(t)||$.isNumeric(e)&&$.isNumeric(t)){const w=this;let f,b;s&&(s.awesomemarker||(s.iconUrl=o(s.iconUrl),s.iconRetinaUrl=o(s.iconRetinaUrl),s.shadowUrl=o(s.shadowUrl),s.shadowRetinaUrl=o(s.shadowRetinaUrl)),f=(new LeafletWidget.DataFrame).cbind(s),b=function(e){const o=f.get(e);return o?o.awesomemarker?(delete o.awesomemarker,o.squareMarker&&(o.className="awesome-marker awesome-marker-square"),o.prefix||(o.prefix=s.library),new L.AwesomeMarkers.icon(o)):(o.iconWidth&&(o.iconSize=[o.iconWidth,o.iconHeight]),o.shadowWidth&&(o.shadowSize=[o.shadowWidth,o.shadowHeight]),o.iconAnchorX&&(o.iconAnchor=[o.iconAnchorX,o.iconAnchorY]),o.shadowAnchorX&&(o.shadowAnchor=[o.shadowAnchorX,o.shadowAnchorY]),o.popupAnchorX&&(o.popupAnchor=[o.popupAnchorX,o.popupAnchorY]),new L.Icon(o)):o.awesomemarker?new L.AwesomeMarkers.icon:new L.Icon.Default}),s&&(f.effectiveLength=e.length);const y=(new LeafletWidget.DataFrame).col("lat",e).col("lng",t).col("radius",a).col("layerId",r).col("group",i).col("popup",c).col("popupOptions",d).col("label",h).col("labelOptions",g).col("highlightOptions",u).col("markerOptions",p).cbind(l);let k;if(l.showStats){var m=L.control();m.onAdd=function(){return this._div=L.DomUtil.create("div","info"),this._div},m.addTo(w),k=function(e,o){var n="";n="function"==typeof o?o(e):"<h4>Statistics</h4><b>Total Distance</b><br/>"+(e.totalDistance?e.totalDistance>1e4?(e.totalDistance/1e3).toFixed(0)+" km":e.totalDistance.toFixed(0)+" m":"invalid")+"<br/><br/><b>Points</b><br/>"+e.points+"<br/><br/><b>Vertices</b><br/>"+e.vertices,m._div.innerHTML=n}}LeafletWidget.methods.addGenericLayers(this,"shape",y,(function(e,o){var t=e.get(o);const a=new L.LatLng(e.get(o,"lat"),e.get(o,"lng")),r=new L.GeodesicCircle(a,t);if(t.showCenter){p=p||{},t.showCenter&&s&&(p.icon=b(o));const i=L.marker(a,p);null!==h&&(null!==g?i.bindTooltip(e.get(o,"label"),g):i.bindTooltip(e.get(o,"label"))),null!==c&&(null!==d?i.bindPopup(e.get(o,"popup"),d):i.bindPopup(e.get(o,"popup"))),w.on("layeradd",(function(n){n.layer===r&&w.layerManager.addLayer(i,"marker",e.get(o,"layerId"),e.get(o,"group"),null,null)})),w.on("layerremove",(function(n){n.layer===r&&w.layerManager.removeLayer("marker",e.get(o,"layerId"))})),i.on("drag",(a=>{r.setLatLng(a.latlng),n(a,"_geodesic_stats",t,e,o,r.statistics,k)})),i.on("click",(a=>{n(a,"_geodesic_click",t,e,o,r.statistics,k)}))}return r.on("click",(a=>{n(a,"_geodesic_click",t,e,o,r.statistics,k)})),r.on("mouseover",(a=>{n(a,"_geodesic_mouseover",t,e,o,r.statistics,k)})),r}))}}})();